# Contributor: Originull Software <packages@originull.org>
# Maintainer: Originull Software <packages@originull.org>
pkgname=apple-bce-stable
pkgver=6.5.4
pkgrel=1
pkgdesc="Apple Buffer Copy Engine driver for T2 Macintoshes"
url="https://github.com/t2linux/apple-bce-drv"
arch="x86_64"
license="GPL-2.0"
depends="dracut linux-stable"
makedepends="linux-stable-dev"
checkdepends=""
install=""
source="https://depot.originull.org/upstream/apple-bce-drv.tar.gz
	dracut.conf"
builddir="$srcdir/apple-bce-drv"
options="!check" # no test suite
install="$pkgname.post-install $pkgname.post-upgrade"

build() {
	make
}

package() {
	mkdir -p "$pkgdir"/boot "$pkgdir"/lib/modules

        local _install
        case "$CARCH" in
                arm*|aarch64) _install="zinstall dtbs_install";;
                *) _install=install;;
        esac

        make -j1 install $_install \
                INSTALL_MOD_PATH="$pkgdir" \
                INSTALL_PATH="$pkgdir"/boot 

	mkdir -p "$pkgdir"/etc/dracut.conf.d/
        cp "$srcdir"/dracut.conf "$pkgdir"/etc/dracut.conf.d/apple-bce.conf
}

sha512sums="
b4c8ef0d205aaa646e305f20470734edb4ace8743ad6a6b7111f40c354645078de8b63042e81b713ce9dafa1a910539accc4292d58e12ba316a9c1b55d3cd6e6  apple-bce-drv.tar.gz
ad55a81db251ed0176c0b37d6b89283610760a4868c234186e444845c1816e7b041caaba57251994ab1a1cc700acb11ac14e7e24178a1a953fd9f7980aeda9f9  dracut.conf
"
