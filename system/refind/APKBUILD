# Maintainer: Originull Software <packages@originull.org>
pkgname=refind
pkgver=0.13.3.2
pkgrel=0
pkgdesc="rEFInd EFI Boot Manager"
url="https://www.rodsbooks.com/refind"
arch="x86_64 aarch64"
options="!check"  # No test suite.
license="GPL-3.0-only"
depends="efibootmgr lsblk"
makedepends="gnu-efi-dev bash"
subpackages="$pkgname-doc"
#source="https://sourceforge.net/projects/refind/files/$pkgver/refind-src-$pkgver.tar.gz"
source="https://depot.originull.org/upstream/refind-src-$pkgver.tar.gz	
	01-bgrt.patch
	02-hollywood-banner.patch
	"

prepare() {
	default_prepare

	# Taken from Arch Linux
	# hardcode RefindDir, so that refind-install can find refind_x64.efi
	sed -e 's|RefindDir=\"\$ThisDir/refind\"|RefindDir="/usr/share/refind/"|g' \
			-i refind-install
}

build() {
	make -j 1 all_gnuefi
}

package() {
	local _target

        case "$CARCH" in
                aarch64*)       _target="aarch64" ;;
                x86_64)         _target="x86_64" ;;
                *)              msg "Unable to determine architecture from (CARCH=$CARCH)" ; return 1 ;;
        esac

	install -Dm0755 refind/*.efi -t "$pkgdir"/usr/share/refind
	install -Dm0755 drivers_*/*.efi -t "$pkgdir"/usr/share/refind/drivers_"$_target"
	install -Dm0755 gptsync/*.efi -t "$pkgdir"/usr/share/refind/tools_"$_target"
	install -Dm0755 refind.conf-sample -t "$pkgdir"/usr/share/refind

	install -Dm0644 docs/man/*.8 -t "$pkgdir"/usr/share/man/man8

	install -Dm0755 mkrlconf mvrefind refind-mkdefault refind-install -t "$pkgdir"/usr/sbin

	cp -r icons $pkgdir/usr/share/refind
}
sha512sums="
579be8bb4c7aae1379b02079716dc7acbfaa27f6542c6d4d924900bc62b73a334a8c3e0cd5e0577fa6f8131354dfc8d4e711864786fb17698902c53a424935f4  refind-src-0.13.3.2.tar.gz
cd02d8063763eb1f63f791b2172a7c424609c7b1f57d1e36b6f446a5febc612c3dd91a2f47dcdcb770956430ce2ddc07d808b43e43e71f3d3e6ed71d01c26b8b  01-bgrt.patch
de0190951dde082ce36d28d5b6e776026dd950efd0363ae4a6b57515b2b9b2078d4fe1124380f0b37eee0d8fc13ef008724aba879402288186e5375003af6f91  02-hollywood-banner.patch
"
