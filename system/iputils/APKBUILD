# Maintainer: Originull Software <packages@originull.org>
pkgname=iputils
pkgver=20240117
pkgrel=0
pkgdesc="IP Configuration Utilities (and Ping)"
options="!check suid"
url="https://github.com/iputils/iputils/"
arch="all"
license="BSD-3-Clause AND GPL-2.0-or-later AND MIT"
makedepends="libcap-dev meson"
replaces="bbsuid"
source="iputils-$pkgver.tar.xz::https://github.com/iputils/iputils/releases/download/$pkgver/iputils-$pkgver.tar.xz"
# checks need suid/setcap'd binaries
# ping is suid
options="suid !check"

build() {
	abuild-meson \
		-DNO_SETCAP_OR_SUID=true \
		-DBUILD_RARPD=true \
		-DBUILD_TFTPD=true \
		-DBUILD_TRACEROUTE6=true \
		-DBUILD_MANS=false \
		-DUSE_IDN=false \
		-DUSE_GETTEXT=false \
		"build"
	ninja -C "build"
}

package() {
	local name
	cd "$builddir"/build

	for name in arping clockdiff rarpd rdisc tftpd/tftpd tracepath; do
		install -D -m755 $name "$pkgdir"/usr/sbin/${name##*/}
	done
	install -D -m755 ninfod/ninfod "$pkgdir"/usr/sbin/ninfod

	for name in ping/ping traceroute6; do
		install -D -m4755 $name "$pkgdir"/bin/${name##*/}
	done

	ln -s tracepath "$pkgdir"/usr/sbin/tracepath6
	ln -s ping "$pkgdir"/bin/ping6
}

sha512sums="
c45822c5641f194dc07cba919c13a4b7a79d050bb53957a894ebb6ccc1f71bac1f26489e13d18ef1ce235982f5fa1824e677f95037a0f5cce6bcb94be4c2e2de  iputils-20240117.tar.xz
"
